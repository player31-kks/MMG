<UserControl x:Class="MMG.Views.TestsContentPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:models="clr-namespace:MMG.Models"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200">
    

    
    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="2*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="1*" MinHeight="200"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="#F8F9FA" 
                BorderBrush="#DEE2E6" 
                BorderThickness="0,0,0,1" 
                Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="테스트 시나리오" 
                               FontSize="24" 
                               FontWeight="Bold" 
                               Foreground="#2C3E50"
                               VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Scenarios.Count, StringFormat='({0}개 시나리오)'}"
                               FontSize="14"
                               Foreground="#6C757D"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="+" 
                            Command="{Binding OpenCreateScenarioDialogCommand}"
                            Width="35"
                            Height="35"
                            FontSize="20"
                            Style="{StaticResource ModernButton}"
                            Background="#007BFF"
                            Margin="0,0,10,0"/>
                    <Button Command="{Binding RefreshScenariosCommand}"
                            Width="35"
                            Height="35"
                            Style="{StaticResource ModernButton}"
                            Background="#6C757D"
                            ToolTip="시나리오 및 저장된 요청 새로고침">
                        <Button.Content>
                            <TextBlock Text="🔄" 
                                       FontSize="16" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"/>
                        </Button.Content>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" MinWidth="250"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="400" MinWidth="300"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*" MinWidth="300"/>
            </Grid.ColumnDefinitions>
            
            <!-- Scenarios List -->
            <Border Grid.Column="0" 
                    Background="#F8F9FA" 
                    BorderBrush="#DEE2E6" 
                    BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Scenarios List -->
                    <ListBox Grid.Row="0" 
                             ItemsSource="{Binding Scenarios}"
                             SelectedItem="{Binding SelectedScenario}"
                             Background="Transparent"
                             BorderThickness="0"
                             Margin="10,0,10,10">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type models:TestScenario}">
                                <Border Background="White" 
                                        BorderBrush="#DEE2E6" 
                                        BorderThickness="1" 
                                        CornerRadius="4" 
                                        Padding="10" 
                                        Margin="0,2">
                                    <Grid MinWidth="150">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        
                                        <!-- 시나리오 이름 (읽기 모드) -->
                                        <TextBlock Grid.Row="0" 
                                                   Text="{Binding Name}" 
                                                   FontWeight="Bold"
                                                   FontSize="14">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                            <TextBlock.InputBindings>
                                                <MouseBinding MouseAction="LeftDoubleClick" 
                                                             Command="{Binding DataContext.RenameScenarioCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                             CommandParameter="{Binding}"/>
                                            </TextBlock.InputBindings>
                                        </TextBlock>
                                        
                                        <!-- 시나리오 이름 (편집 모드) -->
                                        <TextBox Grid.Row="0"
                                                 Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 FontWeight="Bold"
                                                 FontSize="14"
                                                 BorderThickness="1"
                                                 BorderBrush="#007ACC"
                                                 Padding="2">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                            <TextBox.InputBindings>
                                                <KeyBinding Key="Enter" 
                                                           Command="{Binding DataContext.SaveScenarioRenameCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                           CommandParameter="{Binding}"/>
                                                <KeyBinding Key="Escape" 
                                                           Command="{Binding DataContext.CancelScenarioRenameCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                           CommandParameter="{Binding}"/>
                                            </TextBox.InputBindings>
                                        </TextBox>
                                        
                                        <StackPanel Grid.Row="1" 
                                                    Orientation="Horizontal" 
                                                    Margin="0,5,0,0">
                                            <TextBlock Text="{Binding StatusText}"
                                                       FontSize="10">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="#28A745"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsRunning}" Value="True">
                                                                <Setter Property="Foreground" Value="#FFC107"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <Rectangle Width="5" Height="5" 
                                                       VerticalAlignment="Center"
                                                       Margin="10,0,0,0">
                                                <Rectangle.Style>
                                                    <Style TargetType="Rectangle">
                                                        <Setter Property="Fill" Value="#28A745"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsRunning}" Value="True">
                                                                <Setter Property="Fill" Value="#FFC107"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Rectangle.Style>
                                            </Rectangle>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <!-- Scenario Actions -->
                    <StackPanel Grid.Row="1" 
                                Orientation="Horizontal" 
                                Margin="15">
                        <Button Content="실행" 
                                Command="{Binding RunScenarioCommand}"
                                Background="#28A745"
                                Width="60"
                                Margin="0,0,5,0">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource ModernButton}">
                                    <Setter Property="IsEnabled" Value="True"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedScenario}" Value="{x:Null}">
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Opacity" Value="0.5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Command="{Binding StopTestCommand}"
                                Width="60"
                                Margin="5,0,5,0">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource ModernButton}">
                                    <Setter Property="Content" Value="중지"/>
                                    <Setter Property="Background" Value="#DC3545"/>
                                    <Setter Property="IsEnabled" Value="True"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsStopping}" Value="True">
                                            <Setter Property="Content" Value="중지중"/>
                                            <Setter Property="Background" Value="#6C757D"/>
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Opacity" Value="0.7"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsTestRunning}" Value="False">
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Opacity" Value="0.5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Content="삭제" 
                                Command="{Binding DeleteScenarioCommand}"
                                Background="#6C757D"
                                Width="60"
                                Margin="5,0,0,0">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource ModernButton}">
                                    <Setter Property="IsEnabled" Value="True"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedScenario}" Value="{x:Null}">
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Opacity" Value="0.5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Splitter 1 -->
            <GridSplitter Grid.Column="1" 
                          HorizontalAlignment="Stretch" 
                          Background="#DEE2E6"/>
            
            <!-- Test Steps -->
            <Border Grid.Column="2" 
                    Background="White" 
                    BorderBrush="#DEE2E6" 
                    BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" 
                                Orientation="Horizontal" 
                                Margin="15">
                        <TextBlock Text="테스트 스텝" 
                                   FontSize="16" 
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"/>
                        <Button Content="+" 
                                Command="{Binding AddStepCommand}"
                                Width="25" Height="25"
                                Background="#28A745"
                                Foreground="White"
                                BorderThickness="0"
                                Margin="10,0,0,0"
                                FontWeight="Bold">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="IsEnabled" Value="True"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedScenario}" Value="{x:Null}">
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Opacity" Value="0.5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                    
                    <ListBox Grid.Row="1" 
                             ItemsSource="{Binding CurrentSteps}"
                             SelectedItem="{Binding SelectedStep}"
                             Background="Transparent"
                             BorderThickness="0"
                             Margin="15,0,15,10">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type models:TestStep}">
                                <Border Background="#F8F9FA" 
                                        BorderBrush="#DEE2E6" 
                                        BorderThickness="1" 
                                        CornerRadius="4" 
                                        Padding="10" 
                                        Margin="0,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" 
                                                       FontWeight="Bold"/>
                                            <TextBlock Text="{Binding StepType}" 
                                                       FontSize="12"
                                                       Foreground="#6C757D"/>
                                            <TextBlock FontSize="11" Foreground="#6C757D">
                                                <TextBlock.Text>
                                                    <MultiBinding StringFormat="지연: {0}초, 주파수: {1}Hz">
                                                        <Binding Path="DelaySeconds"/>
                                                        <Binding Path="FrequencyHz"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </StackPanel>
                                        
                                        <CheckBox Grid.Column="1" 
                                                  IsChecked="{Binding IsEnabled}"
                                                  VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <Button Grid.Row="2" 
                            Content="선택한 스텝 삭제"
                            Command="{Binding DeleteStepCommand}"
                            Background="#DC3545"
                            Margin="15">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource ModernButton}">
                                <Setter Property="IsEnabled" Value="True"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedStep}" Value="{x:Null}">
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="Opacity" Value="0.5"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>
            
            <!-- Splitter 2 -->
            <GridSplitter Grid.Column="3" 
                          HorizontalAlignment="Stretch" 
                          Background="#DEE2E6"/>
            
            <!-- Step Configuration -->
            <Border Grid.Column="4" Background="White">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="15" DataContext="{Binding SelectedStep}">
                        <TextBlock Text="스텝 구성" 
                                   FontSize="16" 
                                   FontWeight="Bold" 
                                   Margin="0,0,0,15"/>
                        
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Step Name -->
                            <TextBlock Grid.Row="0" Text="스텝 이름:" Margin="0,0,0,5"/>
                            <TextBox Grid.Row="1" 
                                     Text="{Binding Name}" 
                                     Height="40" 
                                     Margin="0,0,0,10"
                                     Style="{StaticResource ModernTextBox}"/>
                            
                            <!-- Step Type -->
                            <TextBlock Grid.Row="2" Text="스텝 유형:" Margin="0,0,0,5"/>
                            <ComboBox Grid.Row="3" 
                                      SelectedValue="{Binding StepType}" 
                                      SelectedValuePath="Tag"
                                      Height="40" 
                                      Margin="0,0,0,10"
                                      Style="{StaticResource ModernComboBox}">
                                <ComboBoxItem Content="단일 요청" Tag="SingleRequest"/>
                                <ComboBoxItem Content="지연된 요청 (3초 대기 → A 실행)" Tag="DelayedRequest"/>
                                <ComboBoxItem Content="주기적 요청 (예: 5Hz로 반복)" Tag="PeriodicRequest"/>
                            </ComboBox>
                            
                            <!-- Saved Request Selection -->
                            <TextBlock Grid.Row="4" Text="사용할 저장된 요청:" Margin="0,0,0,5"/>
                            <ComboBox Grid.Row="5" 
                                      ItemsSource="{Binding DataContext.SavedRequests, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                      SelectedValue="{Binding SavedRequestId}"
                                      SelectedValuePath="Id"
                                      DisplayMemberPath="Name"
                                      Height="30" 
                                      Margin="0,0,0,10"
                                      Style="{StaticResource ModernComboBox}"/>
                            
                            <!-- Configuration based on Step Type -->
                            <StackPanel Grid.Row="6" Margin="0,10,0,0">
                                
                                <!-- Delayed Request Settings -->
                                <Border BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,0,10">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StepType}" Value="DelayedRequest">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <StackPanel>
                                        <TextBlock Text="🕐 지연된 요청 설정" FontWeight="Bold" Margin="0,0,0,10"/>
                                        <TextBlock Text="지연 시간 (초):" Margin="0,0,0,5"/>
                                        <TextBox Text="{Binding DelaySeconds}" 
                                                 Height="40" 
                                                 Margin="0,0,0,10"
                                                 Style="{StaticResource ModernTextBox}"/>
                                        <TextBlock Text="예: 3초 대기 → A 요청 실행" 
                                                   FontSize="11" 
                                                   Foreground="#6C757D" 
                                                   FontStyle="Italic"
                                                   Margin="0,0,0,5"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Periodic Request Settings -->
                                <Border BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,0,10">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StepType}" Value="PeriodicRequest">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <StackPanel>
                                        <TextBlock Text="🔄 주기적 요청 설정" FontWeight="Bold" Margin="0,0,0,10"/>
                                        <TextBlock Text="주파수 (Hz) - 초당 실행 횟수:" Margin="0,0,0,5"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding FrequencyHz}" 
                                                     Height="40" 
                                                     Style="{StaticResource ModernTextBox}"/>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="5,0,0,0">
                                                <Button Content="1Hz" Click="SetFrequency_Click" Tag="1" Width="35" Height="40" FontSize="10"/>
                                                <Button Content="5Hz" Click="SetFrequency_Click" Tag="5" Width="35" Height="40" FontSize="10" Margin="2,0,0,0"/>
                                                <Button Content="10Hz" Click="SetFrequency_Click" Tag="10" Width="35" Height="40" FontSize="10" Margin="2,0,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Text="일반적인 값: 1Hz(느림), 5Hz(보통), 10Hz(빠름), 또는 직접 입력" 
                                                   FontSize="11" 
                                                   Foreground="#6C757D" 
                                                   FontStyle="Italic"
                                                   Margin="0,5,0,10"/>
                                        
                                        <TextBlock Text="실행 시간 (초):" Margin="0,0,0,5"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding DurationSeconds}" 
                                                     Height="40" 
                                                     Style="{StaticResource ModernTextBox}"/>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="5,0,0,0">
                                                <Button Content="5초" Click="SetDuration_Click" Tag="5" Width="35" Height="40" FontSize="10"/>
                                                <Button Content="10초" Click="SetDuration_Click" Tag="10" Width="35" Height="40" FontSize="10" Margin="2,0,0,0"/>
                                                <Button Content="30초" Click="SetDuration_Click" Tag="30" Width="35" Height="40" FontSize="10" Margin="2,0,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Text="예: 10초 x 5Hz = 50회 실행" 
                                                   FontSize="11" 
                                                   Foreground="#6C757D" 
                                                   FontStyle="Italic"
                                                   Margin="0,5,0,5"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Single Request Info -->
                                <Border BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="4" Padding="10" Background="#F8F9FA">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StepType}" Value="SingleRequest">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <StackPanel>
                                        <TextBlock Text="📤 단일 요청 설정" FontWeight="Bold" Margin="0,0,0,5"/>
                                        <TextBlock Text="선택된 저장된 요청을 한 번 실행합니다." 
                                                   FontSize="11" 
                                                   Foreground="#6C757D" 
                                                   FontStyle="Italic"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                            
                            <!-- Save Step Button -->
                            <Button Grid.Row="7" 
                                    Content="스텝 저장"
                                    Command="{Binding DataContext.SaveStepCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    Background="#007BFF"
                                    Height="40"
                                    Margin="0,20,0,0"
                                    FontWeight="Bold">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ModernButton}">
                                        <Setter Property="IsEnabled" Value="True"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                                <Setter Property="IsEnabled" Value="False"/>
                                                <Setter Property="Opacity" Value="0.5"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                        
                        <!-- No Selection Message -->
                        <TextBlock Text="스텝을 선택하여 구성하세요." 
                                   FontStyle="Italic" 
                                   Foreground="#6C757D"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
        
        <!-- Separator between main content and received data -->
        <GridSplitter Grid.Row="2" 
                      Height="5" 
                      HorizontalAlignment="Stretch" 
                      Background="#DEE2E6"/>
        
        <!-- Received Data Section -->
        <Border Grid.Row="3" 
                Background="#F8F9FA" 
                BorderBrush="#DEE2E6" 
                BorderThickness="0,1,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Header for received data -->
                <Border Grid.Row="0" 
                        Background="#E9ECEF" 
                        BorderBrush="#DEE2E6" 
                        BorderThickness="0,0,0,1" 
                        Padding="15,8">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="수신 데이터" 
                                   FontSize="14" 
                                   FontWeight="Bold" 
                                   Foreground="#495057"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ReceivedDataItems.Count, StringFormat='({0}개)'}"
                                   FontSize="12"
                                   Foreground="#6C757D"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"/>
                    </StackPanel>
                </Border>
                
                <!-- Data List -->
                <ListBox Grid.Row="1" 
                         ItemsSource="{Binding ReceivedDataItems}"
                         Background="White"
                         BorderThickness="0"
                         ScrollViewer.CanContentScroll="False"
                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         Padding="5">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:ReceivedDataItem}">
                            <Border Background="White" 
                                    BorderBrush="#DEE2E6" 
                                    BorderThickness="0,0,0,1" 
                                    Padding="10,5">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="60"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" 
                                               Text="{Binding TimeString}" 
                                               FontFamily="Consolas"
                                               FontSize="11"
                                               Foreground="#6C757D"
                                               VerticalAlignment="Top"/>
                                    
                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding IpAddress}" 
                                               FontFamily="Consolas"
                                               FontSize="11"
                                               Foreground="#007ACC"
                                               VerticalAlignment="Top"/>
                                    
                                    <TextBlock Grid.Column="2" 
                                               Text="{Binding Port}" 
                                               FontFamily="Consolas"
                                               FontSize="11"
                                               Foreground="#28A745"
                                               VerticalAlignment="Top"/>
                                    
                                    <TextBlock Grid.Column="3" 
                                               Text="{Binding Data}" 
                                               FontFamily="Consolas"
                                               FontSize="11"
                                               Foreground="#212529"
                                               TextWrapping="Wrap"
                                               VerticalAlignment="Top"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>
        
        <!-- Status Bar with Progress -->
        <Border Grid.Row="4" 
                Background="#343A40" 
                Height="40">
            <Grid Margin="20,5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="{Binding TestProgress}" 
                               Foreground="White" 
                               VerticalAlignment="Center"/>
                    <ProgressBar Width="200" 
                                 Height="20" 
                                 Value="{Binding ProgressPercentage}" 
                                 Maximum="100"
                                 Margin="20,0,0,0">
                        <ProgressBar.Style>
                            <Style TargetType="ProgressBar">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsTestRunning}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ProgressBar.Style>
                    </ProgressBar>
                </StackPanel>
                
                <TextBlock Grid.Column="1" 
                           Text="{Binding ProgressPercentage, StringFormat={}{0}%}" 
                           Foreground="White" 
                           VerticalAlignment="Center">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsTestRunning}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</UserControl>